# Connectors


## Mobile Communications Network (MCN) to Audio Control Module (ACM)

**Socket/Header:** Custom Moulding

This is a custom connector used in the BA, BF, FG, and FG Mk II Falcons.

I suspect some form of custom moulded TE Multilock connector with 51 pins

| Layout | Positions | Contact Width | Pitch       |
|--------|-----------|---------------|-------------|
| 4 x 3  | 12        | 2.2mm         | 3mm x 5mm   |
| 5 x 3	 | 15        | 1.0mm         | 2.54mm x 5mm |
| 8 x 3	 | 24        | 1.0mm         | 2.54mm x 5mm |

## Antenna to ACM

**Socket:** Hirose GT21-1S-HU

**Header:** Hirose GT21-1P-DS

Single position 2 wire shielded coax (specifically designed for antennas)

## MCN to Front Display Module (FDM)

**Socket:** MX84B024SF1

**Header:** MX84B024NF1

2x12 24 Position JAE connector

| Layout | Positions | Contact Width | Pitch |
|--------|-----------|---------------|-------|
| 12 x 2 | 24        | 0.64mm        | 2.2mm |


Runs the (MS) CAN to the ACM. The ACM internally bridges the CAN H and CAN L wires into the Mobile Communication Network (MCN) through the body loom.

2 pins unpopulated, wires are connected in like-for-like wiring and header ends. They are not wired straight through.

## FDM to USB:

**Connector:** Hirose GT17HN-4DS-2C(A)
**Header:** Hirose GT17HNF-4DP-2DS(A)

4 Position Hirose Connector

## FDM to internal daughterboard:

**Receptacle/Connector:** Molex 716617050

50 Position Molex Connector


## FDM internal daughterboard to Interior Comand Center (ICC) keypad:

**Socket:** Hirose DF11-26DS-2C

**Header:** Hirose DF11-26DP-2DSA

2x13 26 position Hi-Rose connector


| Layout | Positions | Contact Width | Pitch |
|--------|-----------|---------------|-------|
| 13 x 2 | 26        |               | 2.0mm |

**Rotary Encoder:**

Alpine EC21A or EC35A

**Cabin Temp Sensor:**

EBM PABST S2000 with external surface mount 10K NTC


# MS CAN PIDs Required by Instrument Cluster



0x425 @ 125ms interval
FE 00 00 00 00 00 00 00

0X307 @ 500ms interval
00 00 00 00 FF 00 00 00 = No Temp


# Additional MS CAN PIDs generated by FDIM

0x2FC 100ms
0x425 125ms
0x313 250ms
0x315 250ms
0x55C 333ms
0x307 500ms




```
0x307 HVAC and Critical Controls

0xFF = no temp
85 ~25-30

00 00 00 00 FF 00 00 00 = No Temp
40 00 00 00 FF 00 00 00 = RECIRC
20 00 00 00 FF 00 00 00 = R DEMIST
80 00 00 00 FF 00 00 00 = ac

00 02 00 00 FF 00 00 00 = F DEMIST
00 04 00 00 FF 00 00 00 = FAN-
00 08 00 00 FF 00 00 00 = FAN+
00 10 00 00 FF 00 00 00 = HVAC OFF
00 20 00 00 FF 00 00 00 = AUTO
00 80 00 00 FF 00 00 00 = VENT

00 00 01 00 FF 00 00 00 =  HAZZARD

00 00 40 00 FF 00 00 00 = TEMP-
00 00 80 00 FF 00 00 00 = TEMP+

00 00 00 04 FF 00 00 00 = UNLOCK
00 00 00 40 FF 00 00 00 = LOCK
00 00 00 10 FF 00 00 00 = DSC
00 00 00 20 FF 00 00 00 = LAMP


0X2FC Media Controls

00 00 01 00 00 20 00 08 = HEAD UNIT OFF STATE

00 00 01 00 00 60 00 08 = ROTARY CW
00 00 01 00 00 A0 00 08 = ROTARY CCW
00 00 81 00 00 20 00 08 = EJECT
00 40 01 00 00 20 00 08 = < SEEK
00 80 01 00 00 20 00 08 = SEEK >
80 00 01 00 00 20 00 08 = FMAM

Follow items are suspected to be pat of 0x2FC, but aren't emitted after the black screen fault has emerged

00 00 01 00 00 20 00 08 = CD
00 00 01 00 00 20 00 08 = SCAN SOMETHING ELSE
00 00 01 00 00 20 00 08 = MEDIA SOMETHING ELSE
00 00 01 00 00 20 00 08 = BACK SOMETHING ELSE
00 00 01 00 00 20 00 08 = MENU SOMETHING ELSE
00 00 01 00 00 20 00 08 = PWR SOMETHING ELSE



0X2F2 Stering Wheel Controls 
00 00 00 01 00 00 00 00 = Seek
00 00 00 02 00 00 00 00 = Vol Up
00 00 00 03 00 00 00 00 = Mode
00 00 00 04 00 00 00 00 = Vol Down
00 00 00 05 00 00 00 00 = Phone


36 Seek ? Could be wrong I had it as 36, clashing with Vol Down
37 Vol Up
37 + 36 Mode
38 Vol Down ? Could be wrong I had it as 36
36 + 38 = Phone
```



# Features

## Safety

- Hazard Lights
- Front Demister
- Rear Demist
- Central Locking
- Unlock
- Interior Lighting (including dimming)
- DSC

## Comfort and Convenience - Single Zone (SZ)

- Internal Temp
- HVAC Off
- Temp
- A/C
- Fan Speed
- Recirculate/Fresh
- Vents
- Reverse Camera
- Reverse Sensors (including trailer attachment detection)

## Entertainment
- External Temp
- Bluetooth Audio
- Aux In
- USB
- DAB+
- RDS
- AM Radio
- FM Radio
- CD (No longer usable)
- Volume Dial
- Bluetooth Phone

## Operational
- OEM Menu
	- Follow me home lighting
- GPS Navigation
- Steerting Wheel Controls
	- Mode
	- Vol Up
	- Vol Down
	- Phone

- Dash Controls
	- Menu
	- Back

# MS Can Messages Decodes

## Speed
0x330 ((D6 * 2) + (D7 / 255))

## RPM
0x330 (D1 * 100) + D2

## Boost
0x120, D7

## Internal Temp

## ICC Key Status

## Steering Wheel Keys
0x2F2 

## Reverse Sensors

## Lateral and Longitudinal G forces
0x397, (D5 * x + D6 ) Long or lat
0x397, (D7 * x + D8 ) Long or lat


## Engine Water Temp
0x44D, (D7 - 40) (seems to be in Â°C)

## Questions
0x403, D4 and D5 Maybe steering angle sensor (until ign off, then 255) 
0x403 

## Battery Voltage
Not sure


Others?
0x128 D5 is some kind of timer? possible speed related timer? i.e. trip computer, distance traveled or something?


# Build
sudo apt install stlink-tools gcc-arm-none-eabi

make

# Deploy
st-flash --reset write fg2-icc-surrogate.bin  0x8000000


# Debug
sudo apt install gdb-multiarch
sudo apt install net-tools

sudo openocd -f /usr/share/openocd/scripts/interface/stlink-v2.cfg -f /usr/share/openocd/scripts/target/stm32f4x_stlink.cfg

sudo netstat -tulpn | grep openocd

gdb-multiarch ./blink-led.elf

target extended-remote localhost:3333

# Debugging
https://www.youtube.com/watch?v=_1u7IOnivnM
# Building and deploying
https://www.youtube.com/watch?v=YEGKD6JQJyM
